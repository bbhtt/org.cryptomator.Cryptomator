{
  "app-id": "org.cryptomator.Cryptomator",
  "command": "cryptomator",
  "runtime": "org.gnome.Platform",
  "runtime-version": "3.32",
  "separate-locales": false,
  "sdk": "org.gnome.Sdk",
  "finish-args": [
    "--device=dri",
    "--filesystem=host",
    "--require-version=1.0.0",
    "--share=ipc",
    "--share=network",
    "--socket=session-bus",
    "--socket=x11",
    "--talk-name=org.freedesktop.Flatpak",
    "--talk-name=org.freedesktop.Notifications",
    "--talk-name=org.freedesktop.secrets",
    "--talk-name=org.gtk.vfs.*",
    "--talk-name=org.gtk.vfs"
  ],
  "build-options": {
    "env": {
      "MOUNT_FUSE_PATH": "../tmp/",
      "V": "1"
    }
  },
  "modules": [
    {
      "name": "libfuse",
      "config-opts": [
        "INIT_D_PATH=/app/etc/init.d",
        "UDEV_RULES_PATH=/app/etc/udev/rules.d"
      ],
      "post-install": [
        "install -m a+rx fusermount-wrapper.sh /app/bin/fusermount"
      ],
      "sources": [
        {
          "type": "archive",
          "sha256": "d0e69d5d608cc22ff4843791ad097f554dd32540ddc9bed7638cc6fea7c1b4b5",
          "url": "https://github.com/libfuse/libfuse/releases/download/fuse-2.9.9/fuse-2.9.9.tar.gz"
        },
        {
          "type": "file",
          "path": "fusermount-wrapper.sh"
        },
        {
          "type": "patch",
          "path": "patches/fuse-disable-sys-mount-under-flatpak.patch"
        },
        {
          "type": "patch",
          "path": "patches/fuse-namespace-conflict.patch"
        }
      ]
    },
    {
      "name": "cryptomator",
      "buildsystem": "simple",
      "build-commands": [
        "bsdtar -xzf appdir.tar.gz --directory=${FLATPAK_DEST}/",
        "install -D -m0755 cryptomator.sh ${FLATPAK_DEST}/bin/cryptomator",
        "install -D -m0644 -t ${FLATPAK_DEST}/share/applications/ ${FLATPAK_ID}.desktop",
        "install -D -m0644 -t ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/ ${FLATPAK_ID}.svg",
        "install -D -m0644 -t ${FLATPAK_DEST}/share/metainfo/ ${FLATPAK_ID}.appdata.xml"
      ],
      "sources": [
        {
          "type": "file",
          "path": "org.cryptomator.Cryptomator.appdata.xml"
        },
        {
          "type": "file",
          "path": "org.cryptomator.Cryptomator.desktop"
        },
        {
          "type": "file",
          "path": "org.cryptomator.Cryptomator.svg"
        },
        {
          "type": "file",
          "sha256": "ae69a9d3ce599dce28ec43ea47e1bc63715e6e5c94d3a4ee2bd9fa9b4ec84cb7",
          "url": "https://dl.bintray.com/cryptomator/cryptomator/1.4.9/appdir.tar.gz"
        },
        {
          "type": "script",
          "commands": ["exec /app/Cryptomator/Cryptomator \"$@\""],
          "dest-filename": "cryptomator.sh"
        }
      ]
    }
  ]
}
